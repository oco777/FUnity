# Scratch モード

Scratch モードは「Scratch 3.0 と同等の制作体験」を目標としたプリセットです。ステージ解像度、座標系、標準ブロックの挙動を FUnity 上で再現し、既存の Scratch プロジェクトからの移行を支援します。

## ステージ仕様
- **ピクセルサイズ**: 480 x 360
- **論理座標**: 中心原点で X ∈ [-240, +240], Y ∈ [-180, +180]
- **Pixels Per Unit**: 100 (1 ユニット = 100 ピクセル)
- **カメラ推奨**: Orthographic / Size = 180 (縦半径) で中央原点に合わせる
- **UI Toolkit**: PanelSettings を `Fit (Contain)`、参照 DPI を 96 とし、背景のレターボックスを抑えます

## 座標系（重要）
- 原点は **ステージ中央(0,0)**。右が +X、上が +Y です。
- UI Toolkit の左上原点座標とはランタイムで自動変換されます。
  - `UI(x, y)` → `Logical(X, Y)` = `(x - W/2, H/2 - y)`
  - `Logical(X, Y)` → `UI(x, y)` = `(X + W/2, H/2 - Y)`
- クランプ処理は実際のステージサイズ `W x H` を基準とし、固定値 480x360 に依存しません。
- `FUnityActorData.Anchor` で **Center (既定)** / **TopLeft** を切り替えられます。Center を選ぶと座標が画像中心に一致し、TopLeft は UI Toolkit と同じ左上基準になります。

## ブロック互換ポリシー
- Scratch 標準カテゴリ（動き/見た目/音/イベント/制御/調べる/演算/変数/リスト）を Visual Scripting で完全再現することを目標にしています。
- ブロックごとのマッピングは [`BlocksMapping.md`](BlocksMapping.md) を参照してください。
- 実装が未完了のブロックはエディタ上で警告を表示し、可能な範囲で近似動作を提供します。未対応一覧は本ドキュメント末尾に記録します。

## SB3 インポート
実験的な `.sb3` インポート機能を提供します。手順は以下の通りです。

1. `FUnity / Authoring / Switch Mode…` で Scratch モードをアクティブ化します。
2. `Assets` 配下に `.sb3` ファイルをドラッグ＆ドロップします。
3. インポーターが `project.json` を解析し、`FUnityProjectData` / `FUnityActorData` に変換します。
4. `assets/` 内の画像は Sprite 化され、音声は `AudioClip` として保存されます。
5. 未対応ブロックが含まれる場合は、インポートレポートに警告が出力されます。

詳細なマッピング仕様は [`SB3_Importer.md`](SB3_Importer.md) にまとめています。

## 既知の制約
- ペン拡張、ビデオモーションセンサーなどハードウェア依存拡張は未対応です。
- ステージ背景の一部エフェクト（ゴースト/モザイク）は近似アルゴリズムを使用します。
- サウンドのテンポ変更は Unity の `AudioMixer` 機能に置き換え、完全互換ではありません。

これらの制約は順次アップデートされる予定です。進捗はリリースノートとドキュメントで共有します。
